<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investigation 1 Concepts Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for correct/incorrect feedback */
        .correct-answer-input {
            border-color: #22c55e; /* green-500 */
            background-color: #f0fdf4; /* green-50 */
        }
        .incorrect-answer-input {
            border-color: #ef4444; /* red-500 */
            background-color: #fef2f2; /* red-50 */
        }
        .correct-answer-label {
            /* This style is no longer used to highlight correct answers, but kept for potential future use */
        }
        .incorrect-answer-selection .selected-label {
             color: #dc2626; /* red-600 */
             text-decoration: line-through;
        }
        .feedback-text {
            font-size: 0.875rem;
            font-weight: 500;
            margin-top: 0.5rem;
        }
        .correct-feedback {
            color: #16a34a; /* green-600 */
        }
        .incorrect-feedback {
            color: #dc2626; /* red-600 */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto max-w-4xl px-4 py-12">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold text-gray-900">Investigation 1 Concepts Quiz</h1>
            <p class="text-lg text-gray-600 mt-2">Test your knowledge of foundational scientific concepts.</p>
        </header>
        
        <div class="bg-white p-8 rounded-2xl shadow-lg">
            <div id="quizContainer">
                <div class="mb-8">
                    <label for="studentName" class="block text-lg font-medium text-gray-800 mb-2">Full Name</label>
                    <input type="text" id="studentName" name="studentName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-lg p-3" placeholder="Enter your name here" required>
                    <p id="nameError" class="text-red-600 text-sm mt-2 hidden">Please enter your name to submit the quiz.</p>
                </div>

                <form id="quizForm" class="space-y-10">

                    <!-- Part 1: Vocabulary Matching -->
                    <fieldset>
                        <legend class="text-2xl font-semibold mb-6 border-b pb-3 w-full">Part 1: Vocabulary Matching</legend>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">
                            <div class="md:col-span-2 text-gray-600">
                                <p>Match the term on the left to the correct definition on the right by writing the letter in the blank.</p>
                            </div>
                            <!-- Terms with input fields -->
                            <div class="space-y-4">
                                <div class="flex items-center" data-question-id="q1">
                                    <label for="q1" class="font-medium w-48">1. Claim</label>
                                    <input type="text" id="q1" name="q1" maxlength="1" class="w-12 text-center rounded-md border-2 border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                                </div>
                                <div class="flex items-center" data-question-id="q2">
                                    <label for="q2" class="font-medium w-48">2. Evidence</label>
                                    <input type="text" id="q2" name="q2" maxlength="1" class="w-12 text-center rounded-md border-2 border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                                </div>
                                <div class="flex items-center" data-question-id="q3">
                                    <label for="q3" class="font-medium w-48">3. Constant</label>
                                    <input type="text" id="q3" name="q3" maxlength="1" class="w-12 text-center rounded-md border-2 border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                                </div>
                                <div class="flex items-center" data-question-id="q4">
                                    <label for="q4" class="font-medium w-48">4. Collision</label>
                                    <input type="text" id="q4" name="q4" maxlength="1" class="w-12 text-center rounded-md border-2 border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                                </div>
                                <div class="flex items-center" data-question-id="q5">
                                    <label for="q5" class="font-medium w-48">5. Independent Variable</label>
                                    <input type="text" id="q5" name="q5" maxlength="1" class="w-12 text-center rounded-md border-2 border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                                </div>
                                <div class="flex items-center" data-question-id="q6">
                                    <label for="q6" class="font-medium w-48">6. Force</label>
                                    <input type="text" id="q6" name="q6" maxlength="1" class="w-12 text-center rounded-md border-2 border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                                </div>
                                <div class="flex items-center" data-question-id="q7">
                                    <label for="q7" class="font-medium w-48">7. System</label>
                                    <input type="text" id="q7" name="q7" maxlength="1" class="w-12 text-center rounded-md border-2 border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                                </div>
                                <div class="flex items-center" data-question-id="q8">
                                    <label for="q8" class="font-medium w-48">8. Vertical</label>
                                    <input type="text" id="q8" name="q8" maxlength="1" class="w-12 text-center rounded-md border-2 border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                                </div>
                                <div class="flex items-center" data-question-id="q9">
                                    <label for="q9" class="font-medium w-48">9. Horizontal</label>
                                    <input type="text" id="q9" name="q9" maxlength="1" class="w-12 text-center rounded-md border-2 border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                                </div>
                                <div class="flex items-center" data-question-id="q10">
                                    <label for="q10" class="font-medium w-48">10. Data</label>
                                    <input type="text" id="q10" name="q10" maxlength="1" class="w-12 text-center rounded-md border-2 border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                                </div>
                                <div class="flex items-center" data-question-id="q11">
                                    <label for="q11" class="font-medium w-48">11. Mass</label>
                                    <input type="text" id="q11" name="q11" maxlength="1" class="w-12 text-center rounded-md border-2 border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                                </div>
                            </div>
                            <!-- Definitions -->
                            <div class="space-y-2 text-sm text-gray-700 bg-gray-50 p-4 rounded-lg">
                                <p><strong>A.</strong> An event where two or more objects hit each other.</p>
                                <p><strong>B.</strong> The direction that goes up and down.</p>
                                <p><strong>C.</strong> A push or a pull on an object.</p>
                                <p><strong>D.</strong> A set of interacting parts forming a whole.</p>
                                <p><strong>E.</strong> The one variable a scientist changes on purpose.</p>
                                <p><strong>F.</strong> The facts or data used to support your answer.</p>
                                <p><strong>G.</strong> The direction that is flat, like the horizon.</p>
                                <p><strong>H.</strong> The amount of matter or "stuff" in an object.</p>
                                <p><strong>I.</strong> A single-sentence statement that answers a question.</p>
                                <p><strong>J.</strong> The factors that are kept the same during an experiment.</p>
                                <p><strong>K.</strong> Facts, figures, and other evidence gathered through observations.</p>
                            </div>
                        </div>
                    </fieldset>

                    <!-- Part 2: Identify the Variables -->
                    <fieldset data-question-id="q12">
                        <legend class="text-2xl font-semibold mb-6 border-b pb-3 w-full">Part 2: Identify the Variables</legend>
                        <div class="bg-blue-50 border border-blue-200 p-4 rounded-lg mb-6">
                            <p class="text-gray-700"><strong>Scenario:</strong> A student wants to test how the brand of a golf ball affects how far it will fly. She gets three different brands of golf balls and hits each one with the same golf club, using the same amount of force in her swing. She then measures how far each ball travels.</p>
                        </div>
                        <div class="space-y-8">
                            <div>
                                <p class="block text-md font-medium text-gray-700 mb-2">12. What is the independent variable in this experiment?</p>
                                <div class="space-y-2 mt-2">
                                    <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                                        <input type="radio" name="q12" value="a" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                        <span class="ml-3 text-gray-700 selected-label">The brand of the golf ball</span>
                                    </label>
                                    <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                                        <input type="radio" name="q12" value="b" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                        <span class="ml-3 text-gray-700 selected-label">The distance the ball travels</span>
                                    </label>
                                     <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                                        <input type="radio" name="q12" value="c" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                        <span class="ml-3 text-gray-700 selected-label">The golf club used</span>
                                    </label>
                                </div>
                            </div>
                            <div data-question-id="q13">
                                <p class="block text-md font-medium text-gray-700 mb-2">13. What is the dependent variable (what is being measured)?</p>
                                 <div class="space-y-2 mt-2">
                                    <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                                        <input type="radio" name="q13" value="a" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                        <span class="ml-3 text-gray-700 selected-label">The brand of the golf ball</span>
                                    </label>
                                    <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                                        <input type="radio" name="q13" value="b" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                        <span class="ml-3 text-gray-700 selected-label">The distance the ball travels</span>
                                    </label>
                                     <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                                        <input type="radio" name="q13" value="c" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                        <span class="ml-3 text-gray-700 selected-label">The force of the swing</span>
                                    </label>
                                </div>
                            </div>
                            <div data-question-id="q14">
                                <p class="block text-md font-medium text-gray-700 mb-2">14. What is one constant the student is trying to keep the same?</p>
                                 <div class="space-y-2 mt-2">
                                    <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                                        <input type="radio" name="q14" value="a" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                        <span class="ml-3 text-gray-700 selected-label">The brand of the golf ball</span>
                                    </label>
                                    <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                                        <input type="radio" name="q14" value="b" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                        <span class="ml-3 text-gray-700 selected-label">The distance the ball travels</span>
                                    </label>
                                     <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                                        <input type="radio" name="q14" value="c" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                        <span class="ml-3 text-gray-700 selected-label">The golf club used</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </fieldset>

                    <!-- Part 3: Analyze the Data -->
                    <fieldset>
                        <legend class="text-2xl font-semibold mb-6 border-b pb-3 w-full">Part 3: Analyze the Data</legend>
                        <div class="mb-6">
                            <h3 class="font-medium text-gray-700">Experiment: How Ramp Height Affects Collision Damage</h3>
                            <div class="overflow-x-auto mt-2">
                                <table class="min-w-full divide-y divide-gray-200 border rounded-lg">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Starting Height of Cart</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Depth of Dent in Clay</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        <tr><td class="px-6 py-4 whitespace-nowrap">10 cm</td><td class="px-6 py-4 whitespace-nowrap">4 mm</td></tr>
                                        <tr><td class="px-6 py-4 whitespace-nowrap">20 cm</td><td class="px-6 py-4 whitespace-nowrap">9 mm</td></tr>
                                        <tr><td class="px-6 py-4 whitespace-nowrap">30 cm</td><td class="px-6 py-4 whitespace-nowrap">15 mm</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="space-y-8">
                            <div data-question-id="q15">
                                <p class="block text-md font-medium text-gray-700 mb-2">15. Based on the pattern in the data, what does a greater starting height lead to?</p>
                                <div class="space-y-2 mt-2">
                                    <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                                        <input type="radio" name="q15" value="a" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                        <span class="ml-3 text-gray-700 selected-label">Less damage</span>
                                    </label>
                                    <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                                        <input type="radio" name="q15" value="b" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                        <span class="ml-3 text-gray-700 selected-label">Greater damage</span>
                                    </label>
                                     <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                                        <input type="radio" name="q15" value="c" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                        <span class="ml-3 text-gray-700 selected-label">No change in damage</span>
                                    </label>
                                </div>
                            </div>
                            <div data-question-id="q16">
                                <p class="block text-md font-medium text-gray-700 mb-2">16. Which statement is the best scientific Claim based on the data?</p>
                                <div class="space-y-2 mt-2">
                                    <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                                        <input type="radio" name="q16" value="a" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                        <span class="ml-3 text-gray-700 selected-label">Ramp height does not affect collision damage.</span>
                                    </label>
                                    <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                                        <input type="radio" name="q16" value="b" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                        <span class="ml-3 text-gray-700 selected-label">Increasing the starting height of the cart causes more damage in a collision.</span>
                                    </label>
                                     <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                                        <input type="radio" name="q16" value="c" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                        <span class="ml-3 text-gray-700 selected-label">Clay is soft.</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </fieldset>

                    <!-- Part 4: Key Concepts & Reasoning -->
                    <fieldset>
                        <legend class="text-2xl font-semibold mb-6 border-b pb-3 w-full">Part 4: Key Concepts & Reasoning</legend>
                         <div class="space-y-8">
                            <div data-question-id="q17">
                                <p class="block text-md font-medium text-gray-700 mb-2">17. What are the two main factors we can change to increase the force of a collision?</p>
                                 <div class="space-y-2 mt-2">
                                    <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                                        <input type="radio" name="q17" value="a" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                        <span class="ml-3 text-gray-700 selected-label">Increase the mass and increase the speed.</span>
                                    </label>
                                    <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                                        <input type="radio" name="q17" value="b" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                        <span class="ml-3 text-gray-700 selected-label">Decrease the mass and decrease the speed.</span>
                                    </label>
                                     <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                                        <input type="radio" name="q17" value="c" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                        <span class="ml-3 text-gray-700 selected-label">Increase the mass and decrease the speed.</span>
                                    </label>
                                </div>
                            </div>
                            <div data-question-id="q18">
                                <p class="block text-md font-medium text-gray-700 mb-2">18. A more massive cart moved slower but still caused more damage. Why did this happen?</p>
                                <div class="space-y-2 mt-2">
                                    <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                                        <input type="radio" name="q18" value="a" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                        <span class="ml-3 text-gray-700 selected-label">The added mass made the cart more aerodynamic.</span>
                                    </label>
                                    <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                                        <input type="radio" name="q18" value="b" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                        <span class="ml-3 text-gray-700 selected-label">The heavier cart had more mass, which was a more important factor than its slower speed.</span>
                                    </label>
                                     <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                                        <input type="radio" name="q18" value="c" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                        <span class="ml-3 text-gray-700 selected-label">The ramp was not steep enough.</span>
                                    </label>
                                </div>
                            </div>
                             <div data-question-id="q19">
                                <p class="block text-md font-medium text-gray-700 mb-2">19. Why is it important to only change one variable at a time in an experiment?</p>
                                <div class="space-y-2 mt-2">
                                    <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                                        <input type="radio" name="q19" value="a" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                        <span class="ml-3 text-gray-700 selected-label">It makes the experiment take less time.</span>
                                    </label>
                                    <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                                        <input type="radio" name="q19" value="b" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                        <span class="ml-3 text-gray-700 selected-label">It is safer for the person conducting the experiment.</span>
                                    </label>
                                     <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                                        <input type="radio" name="q19" value="c" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                        <span class="ml-3 text-gray-700 selected-label">It allows you to know which variable was responsible for the results.</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </fieldset>

                    <!-- Submission Button -->
                    <div class="text-center pt-6">
                         <button type="submit" id="submitButton" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50 transition-transform transform hover:scale-105 w-full md:w-auto">
                            Check Answers
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Results Section -->
            <div id="resultsContainer" class="hidden text-center">
                <h2 class="text-3xl font-bold text-center mb-4">Quiz Results</h2>
                <div id="studentNameResult" class="text-xl font-semibold text-center text-gray-700 mb-4"></div>
                <div id="score" class="text-2xl font-bold text-center text-indigo-600 mb-6"></div>
                <div id="incorrectQuestionsList" class="text-center"></div>
                <div id="submissionStatus" class="mt-6 text-lg"></div>
                 <div class="text-center mt-8">
                    <button onclick="window.location.reload()" class="bg-gray-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-600 transition-colors">
                        Take Again
                    </button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- CONFIGURATION ---
        // After following the setup_guide.md, paste your Google Apps Script URL here.
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbztsH22Mkj2kMf1GmneNJAwMc6uwE72bzfP-FFE2c_A2hrsRYlRL_yqy3tRAP3RLInSAg/exec';

        const quizForm = document.getElementById('quizForm');
        const submitButton = document.getElementById('submitButton');
        const quizContainer = document.getElementById('quizContainer');
        const resultsContainer = document.getElementById('resultsContainer');
        const submissionStatus = document.getElementById('submissionStatus');

        quizForm.addEventListener('submit', function(event) {
            event.preventDefault();
            
            submitButton.disabled = true;
            submitButton.textContent = 'Submitting...';

            const studentNameInput = document.getElementById('studentName');
            const studentName = studentNameInput.value.trim();
            const nameError = document.getElementById('nameError');

            if (!studentName) {
                nameError.classList.remove('hidden');
                studentNameInput.focus();
                submitButton.disabled = false;
                submitButton.textContent = 'Check Answers';
                return;
            }
            nameError.classList.add('hidden');

            const answerKey = {
                q1: 'i', q2: 'f', q3: 'j', q4: 'a', q5: 'e', q6: 'c', q7: 'd', q8: 'b', q9: 'g', q10: 'k', q11: 'h',
                q12: 'a', q13: 'b', q14: 'c', q15: 'b', q16: 'b', q17: 'a', q18: 'b', q19: 'c',
            };
            
            const allQuestions = Object.keys(answerKey);
            let score = 0;
            let incorrectQuestions = [];
            let studentAnswers = {};

            const allInputs = this.querySelectorAll('input');
            allInputs.forEach(input => {
                input.classList.remove('correct-answer-input', 'incorrect-answer-input');
                const parentLabel = input.closest('label');
                if (parentLabel) parentLabel.classList.remove('incorrect-answer-selection');
            });

            allQuestions.forEach(id => {
                const input = document.getElementById(id);
                const radioInput = document.querySelector(`input[name="${id}"]:checked`);
                let isCorrect = false;
                let userAnswer = '';

                if (input) {
                    userAnswer = input.value.trim().toLowerCase();
                    if (userAnswer === answerKey[id]) {
                        score++;
                        isCorrect = true;
                    }
                    input.classList.add(isCorrect ? 'correct-answer-input' : 'incorrect-answer-input');
                } else if (radioInput) {
                    userAnswer = radioInput.value;
                    const selectedLabel = radioInput.closest('label');
                    if (userAnswer === answerKey[id]) {
                        score++;
                        isCorrect = true;
                    }
                    if(!isCorrect) selectedLabel.classList.add('incorrect-answer-selection');
                }
                
                studentAnswers[id] = userAnswer;
                if (!isCorrect) incorrectQuestions.push(id.replace('q', ''));
            });
            
            const quizData = {
                studentName: studentName,
                score: score,
                totalQuestions: allQuestions.length,
                incorrectQuestions: incorrectQuestions,
                timestamp: new Date().toISOString()
            };

            // --- Display Results ---
            document.getElementById('studentNameResult').textContent = `Results for: ${studentName}`;
            document.getElementById('score').textContent = `You scored ${score} out of ${allQuestions.length}.`;
            
            const incorrectListContainer = document.getElementById('incorrectQuestionsList');
            if (incorrectQuestions.length > 0) {
                incorrectListContainer.innerHTML = `<p class="font-medium text-red-700 mt-4">Please review question(s): <span class="font-bold">${incorrectQuestions.join(', ')}</span></p>`;
            } else {
                incorrectListContainer.innerHTML = `<p class="font-medium text-green-700 mt-4">Excellent work! You got all questions correct!</p>`;
            }

            quizContainer.classList.add('hidden');
            resultsContainer.classList.remove('hidden');
            resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // --- Send Data to Google Sheet ---
            if (SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                submissionStatus.textContent = 'Data not saved. Teacher setup required.';
                submissionStatus.className = 'mt-6 text-lg text-yellow-600';
                console.log("--- QUIZ SUBMISSION DATA (Not Sent) ---");
                console.log(JSON.stringify(quizData, null, 2));
                return;
            }

            submissionStatus.textContent = 'Saving your results...';
            submissionStatus.className = 'mt-6 text-lg text-gray-600';

            fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'cors',
                cache: 'no-cache',
                // Removed headers to let the browser set the correct Content-Type.
                // Google Apps Script can be particular about this.
                body: JSON.stringify(quizData)
            })
            .then(response => {
                // Check if the response from the server is successful
                if (!response.ok) {
                    throw new Error(`Network response was not ok. Status: ${response.status}`);
                }
                // Google Apps Script on success might return a redirect, so we check the response type
                // A successful post usually results in a simple text or json response.
                // If it fails, it might return an HTML error page.
                return response.json().catch(() => {
                    // If parsing as JSON fails, it might be a different kind of error response.
                    // We'll log this for more robust debugging.
                    throw new Error('Response was not JSON. The script might need to be redeployed.');
                });
            })
            .then(data => {
                console.log('Success:', data);
                if(data.result === 'success') {
                    submissionStatus.textContent = 'Your results have been saved!';
                    submissionStatus.className = 'mt-6 text-lg text-green-600';
                } else {
                    throw new Error(data.message || 'An unknown error occurred in the Google Script.');
                }
            })
            .catch(err => {
                console.error('Error during submission:', err);
                submissionStatus.textContent = `Could not save results. Error: ${err.message}`;
                submissionStatus.className = 'mt-6 text-lg text-red-600';
            });
        });
    </script>
</body>
</html>

